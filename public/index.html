<html>
  <head>
  	<!-- Bootstrap -->
  	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

  	<!-- speak.js -->
    <script src="speakClient.js"></script>

    <link rel="stylesheet" type="text/css" href="/css/animations.css"/>
    <link rel="stylesheet" type="text/css" href="/css/index.css"/>
  </head>

  <body>

  	<div class="container-fluid">

  		<!-- Hawking's floating head -->
  		<div class="row center">
				<img id="stephen-head" class="float" src="./stephen.jpg" alt="Stephen Hawking"/>
  		</div>

  		<!-- Answer container -->
  		<div class="container answer-container">
				<p id="answer"></p>
  		</div>

  		<!-- Input container -->
  		<div class="row">
	  		<div class="col-sm inputs-container">
			    <input tyle="text" id="question-input"></input>
			    <button id="ask">Ask</button>
			  </div>
			</div>

	  </div>

	  <!-- Audio source -->
	  <div id="audio"></div>
  </body>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.0/socket.io.js"></script>

  <script>
		const SPEAK_CONFIG = { speed: 150, wordgap: 3, pitch: 62  }
		const callSpeak = (text) => speak(text, SPEAK_CONFIG)
	  const deliverAnswer = (answer) => {
	  	// Deliver text
	  	const span = document.getElementById("answer")
	  	while (span.firstChild) {
	  	    span.removeChild(span.firstChild);
	  	}
	  	span.appendChild(document.createTextNode(answer));

	  	// Deliver audio
	  	callSpeak(answer)
	  }

	  // Text "analysis" :^)
		const includes = (text, keywords) => keywords.reduce((acc, word) => acc && text.includes(word))

		// Shamelessly hardcoded answers
		const defaultAnswer = "I am both sure and unsure of your question. Try measuring it better."
		const keygroups = [{
			keywords: ["black", "hole"],
			answer: "According to the theory of relativity, nothing can travel faster than light. Thus if light cannot escape,neither can anythingelse.everything is dragged back by the gravitational field. So one has a set of events, a region of space-time, from which it is not possible to escape to reach a distant observer. This region is what we now call a black hole.",
		}, {
			keywords: ["back", "time"],
			answer: "A possible way to explain the absence of visitors from the future would be to say that the past is fixed because we have observed it and seen that it does not have the kind of warping needed to allow travel back from the future. On the other hand, the future is unknown and open, so it might well have the curvature required. This would mean that any time travel would be confined to the future. There would be no chance of Captain Kirk andthe Starship Enterprise turning up at the present time."
		}, {
			keywords: ["time", "travel"],
			answer: ""
		}, {
			keywords: ["what", "universe"],
			answer: "Today scientists describe the universe in terms of two basic partial theories â€“ the general theory of relativity  and quantum mechanics. They are the great intellectual achievements of the first half of this century."
		}, {
			keywords: ["what", "general", "theory", "relativity"],
			answer: "The general theory of relativity describes the force of gravity and the large-scale structure of the universe, that is, the structure on scales from only a few miles to as large as a million million million million (1 with twenty-four zeros after it) miles, the size of the observable universe."
		}, {
			keywords: ["what", "quantum", "mechanics"],
			answer: "Quantum mechanics deals with phenomena on extremely small scales, such as a millionth of a millionth of an inch."
		}, {
			keywords: ["what", "hawking", "radiation"],
			answer: "In fact, black holes should thermally create and emit sub-atomic particles, which I called a radiation, until they exhaust their energy and evaporate completely.According to this theory, black holes are not completely black, and neither do they last forever."
		}, {
			keywords: ["big", "bang", "theory"],
			answer: "The Big Bang Theory is the leading explanation about how the universe began. At its simplest, it says the universe as we know it started with a small singularity,then inflated over the next 13.8 billion years to the cosmos that we know today."
		}, {
			keywords: ["what", "is", "the", "time"],
			answer: "Ask Einstein"
		},{
			keywords: ["what's", "the", "time"],
			answer: ""
		},{
			keywords: ["can", "tell", "story", "inspire"],
			answer: "It became clear something was not quite right with me, I fell over and had great difficulty getting up again.\nMy mother realized something was wrong and took me to the doctor.I spent weeks in Bart's Hosptal and had many tets.\nThey never actually told me what was wrong, but I guessed enough to know it was pretty bad.\nIn fact, the doctor who diagnosed me wahsed his hands of me and I never saw him again. He felt that there was nothing that could be done and first I became depressed, I seemed to be getting wors pretty rapidly.\nThere didn't seem any point working on my PhD, because I did not know if I live long enough to finish it.\nI had come to Cambridge to do cosmology, and cosmology I was determined to do. Then the condition developed more slowly, and I began to make progrees in my work. After my expectations had been reduced to zero, every new day became a bonus, and I began to appreciate everything I did have. And there was also a young woman called Jane, whom I had met at party. Getting engaged lifted my spirits, and I realized while there's life, there is hope. There are many ambitious experiments planned for the future.\nWe will map the positions of billions of galaxies, and we will beter undertand our place in the universe.\nBut we must also continiue  to go into space for the future of humanity. I don't think we will survive another thousands years without escaping beyond our fragile planet.\nIt has been a glorius time to be alive, doung research in theoritical physics. The fact that we humans, who are ourselves mere collections of fundamental particles of nature, have been able to come this cloe to an understanding of the laws governing us and our universe is a grea triumph, and I am happy if I have made a small contribution. I want to share my excitement and enthusiasm about this quest, so remember to look up at the stars and not down at your feet.\nTry to make sence of what you see, and wonder about what makes the universe exist. Be curious. And however difficult life may seem, there is always something you can do an succeed at. It matters that you don't just give up. While there's life, there is hope."
		},{
			keywords: ["can", "tell", "inspiring"],
			answer: ""
		},{
			keywords: ["can", "tell", "joke"],
			answer: "A quark doesn't walk into a bar and orders a drink from the bar. Haha!"
		},{
			keywords: ["sword", "cool"],
			answer: "O==():::::::::>"
		}]

		function evaluateQuestion(question) {
			for (let i in keygroups) {
				if (includes(question, keygroups[i].keywords)) {
					let kg = keygroups[i]
					while (kg.answer === "") {
						i -= 1
						kg = keygroups[i]
					}
					return deliverAnswer(kg.answer)
				}
			}

			return deliverAnswer(defaultAnswer)
		}

	  function onLoad() {
	  	const socket = io()

	  	socket.on("answer", (answer) => {
  			deliverAnswer(answer)
	  	})

	    document.getElementById("ask").onclick = () => {
	    	const question = document.getElementById("question-input").value.toLowerCase()
	    	socket.emit("question", question)
	    	//evaluateQuestion(question)
	    }
		}

		// Waits for document to load
	  if (document.readyState !== "loading"){
	    onLoad()
	  } else {
	    document.addEventListener("DOMContentLoaded", onLoad)
	  }
  </script>
</html>
